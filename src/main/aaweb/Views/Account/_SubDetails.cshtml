@using AllyisApps.ViewModels

@model SubscriptionDisplayViewModel

@{
    ViewBag.Title = AllyisApps.Resources.Views.Account.Strings.Subscriptions;
    ViewBag.ShowAll = true;
    string productTier = Model.Info != null ? Model.Info.Tier : string.Empty;
    string getText = string.IsNullOrWhiteSpace(productTier) ? AllyisApps.Resources.Views.Account.Strings.Subscribe : productTier == "Free" ? AllyisApps.Resources.Views.Account.Strings.Manage : AllyisApps.Resources.Views.Account.Strings.Upgrade;
    string userDisplay = string.Empty;
    string price = string.Empty;
    if (Model.Info != null)
    {
        userDisplay = string.Format("{0}/{1} {2}", Model.Info.SubscriptionsUsed, Model.Info.NumberOfUsers, AllyisApps.Resources.Views.Account.Strings.Users);
        price = (Model.Info.NumberOfUsers - 5) == 0 ? AllyisApps.Resources.Views.Account.Strings.Free : (Model.Info.NumberOfUsers - 5).ToString("c");
    }
}

<table class="table table-striped table-sparse">
    <tr>
        @if (Model.ProductName == "TimeTracker")
        {
            <td>
                @AllyisApps.Resources.Views.Account.Strings.TimeTracker
            </td>
        }
        @if (Model.Info != null)
        {
            <td>@userDisplay</td>
            <td class="text-right">
                @price
            </td>
            <td class="text-right icon-strip">
                @if (Model.CanEditSubscriptions)
                {
                    <a href="@Url.Action(ActionConstants.Subscribe, ControllerConstants.Account, new { ProductId = @Model.ProductId })"
                       class="text-muted" title="@AllyisApps.Resources.Views.Account.Strings.EditSubscription"><span class="fa fa-fw fa-dollar text-success"></span></a>

                    using (Html.BeginForm(ActionConstants.Unsubscribe, ControllerConstants.Account, FormMethod.Get, new { @style = "display: inline", @onsubmit = "return confirmUnsubscribe(\"" + @Model.ProductName + "\")" }))
                    {
                        <input data-val="true" id="ID" name="ID" type="hidden" value="@Model.ProductId" />
                        <a href="javascript:void(0);" class="text-danger" title="@AllyisApps.Resources.Views.Account.Strings.DropSubcription" onclick="$(this).closest('form').submit()"><span class="fa fa-fw fa-remove text-danger" title=@AllyisApps.Resources.Views.Account.Strings.RemoveSubscription ></span></a>
                    }
                }
            </td>
        }
        else
        {
            <td class="text-right">
                @Html.ActionLink(getText, ActionConstants.Subscribe, ControllerConstants.Account, new { ProductId = Model.ProductId }, null)
            </td>
        }
    </tr>
</table>

<script>
    function confirmUnsubscribe(subname) {
        return confirm("@(AllyisApps.Resources.Views.Account.Strings.WarningWhenUnsubscribing)".replace(/%subname%/g, subname))
    }
</script>