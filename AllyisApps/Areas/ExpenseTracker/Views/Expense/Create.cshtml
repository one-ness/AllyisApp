@using AllyisApps.ViewModels.ExpenseTracker.Expense;
@using AllyisApps.Core;
@using AllyisApps.Services;

@model ExpenseCreateModel

@{
	ViewBag.Title = Strings.Report;
	Layout = "~/Areas/ExpenseTracker/Views/Shared/_Layout.cshtml";
	string submitAction = Model.Report == null ? "CreateReport" : "UpdateReport";
	string submitName = Model.Report == null ? "Create" : "Update";
}

<div class="panel panel-info" style="background-color: #f5f5f5; float: right; width: 300px;">
	<div class="panel-heading"><span class="panel-title">@Strings.Upload</span></div>
	@using (Html.BeginForm(ActionConstants.Import, ControllerConstants.Expense, new { subscriptionid = Model.SubscriptionId }, FormMethod.Post, new { enctype = "multipart/form-data" }))
		{
		@Html.AntiForgeryToken();
		<div>
			<input type="file" id="upload-box" name="upload" style="display:none;"
					onchange="$('#upload-file-name-display').val($(this).val().replace('C:\\fakepath\\', ''));" />
			<input id="upload-file-name-display" class="form-control"
					onchange="$('#upload-file-name-display').val($(this).val().replace('C:\\fakepath\\', ''));" />
		</div>
		@*<div style="width:70%; margin:0 auto">*@
		<div id="footUpload" style="background-color:#f5f5f5; display: flex; justify-content: space-around; flex-wrap: wrap; padding-bottom: 0px; float:right; margin-top: 10px;">
			<a onclick="$('input[id=upload-box]').click();" title="Choose Excel file containing Expense Tracker entries">
				<span class="btn btn-primary">@Strings.ChooseFile</span>
			</a>
			<input type="submit" style="margin-left: 3px; margin-right: 3px;" id="upload-button" value="@Strings.Upload" class="btn btn-primary" title="Upload Excel Expense Tracker entries" />
		</div>
		}
	@using (Html.BeginForm(ActionConstants.Template, ControllerConstants.Expense, null, FormMethod.Get, new { style = "margin-bottom:10px;" }))
		{
		<div style="margin-top: 10px; margin-left: 3px; margin-bottom:10px;">
			<input type="submit" id="template-button" value="@Strings.Template" class="btn btn-primary tt-template" title="Download Excel Expense Tracker template" />
		</div>
		}
</div>
<div class="col-md-6" style="float: left;">
	<div class="row">
		@using (Html.BeginForm(submitAction, ControllerConstants.Expense, FormMethod.Post, htmlAttributes: new { @id = "reportForm" }))
		{
			string dateVal = "";
			int reportId = Model.Report == null ? -1 : Model.Report.ExpenseReportId;
			if (Model.Report == null)
			{
				Model.Report = new ExpenseReport();
				Model.Items = new List<ExpenseItem>();
			}
			else
			{
				dateVal = Model.Report.ReportDate.ToShortDateString();
			}
			<input type="hidden" name="reportId" value="@reportId" />
			<input type="hidden" name="accountId" value="@Model.CurrentUser" />
			<input type="hidden" name="submittedById" value="@Model.CurrentUser" />
			<input type="hidden" name="subscriptionId" value="@Model.SubscriptionId" />
            <div class="options-right container">
				<div class="form-group" style="width: 50%;">
					<div class="left-label">
						<label>Report Name</label>
					</div>
					<div class="right-input">
						@Html.TextBoxFor(m => m.Report.ReportTitle, new { @class = "form-control", name = "ReportName", Value = Model.Report.ReportTitle })
					</div>
					<div class="left-label">
						<label>Business Justification</label>
					</div>
					<div class="right-input">
						<input type="text" name="BusinessJustification" value="@Model.Report.BusinessJustification" class="form-control" />
					</div>
					<div class="left-label">
						<label>@Strings.Date</label>
					</div>
					<div class="right-input">
						@Html.TextBoxFor(m => m.Report.ReportDate, new { @class = "datepicker form-control", name = "date", Value = dateVal, id = "DateRangeStart" })
					</div>
					<input type="hidden" id="DateRangeStart" name="DateRangeStart" value="@Model.StartDate" />
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">
						Items
					</div>
					<div class="items">
						@{
							Model.Items.Add(new ExpenseItem());
							Html.RenderAction("AddItem", Model);
						}
					</div>
					<div style="text-align: center;">
						<a class="addItem">
							<span class="btn btn-primary">
								Add Item
							</span>
						</a>
					</div>
				</div>

				<div class="row">
					<div class="col-xs-12">
						<div>
							<input class="btn btn-primary pull-left" type="submit" name="viewDataButton" value=@submitName title="Export Excel Expense Tracker entries" />
						</div>
					</div>
				</div>
			</div>
		}
	</div>
	<br>
</div>

@*<div class="col-xs-12">
	<div class="panel panel-default">
		<div class="panel-body" style="padding: 0px">
		</div>
		<div id="data-message" class="panel-footer">
		</div>
	</div>
</div>*@

@section css
{
	<link rel="stylesheet" type="text/css" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" type="text/css" href="~/Content/jquery.comiseo.daterangepicker.css" />
}

@section scripts
{
	@*Date range picker dependencies:*@
	@Scripts.Render("~/bundles/jqueryui")
	@Scripts.Render("~/bundles/moment")

	<script src="~/Scripts/allyis-pages-with-filter.js" type="text/javascript"></script>
	@Scripts.Render("~/bundles/daterangepicker")
	<script type="text/javascript">
		pwf.setPageLimit(15);
		pwf.setPageButtonLimit(10);
		pwf.setRowClass("previewRow");
		$('.datepicker').each(function () {
			$(this).datepicker();
		});
		@*$(function () {
			$('.addItem').on('click', function () {
				$('.items').load('@Url.Action("AddItem")', @Html.Raw(Json.Encode(@Model)));
			});
		});*@
	</script>
}
