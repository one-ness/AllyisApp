@using AllyisApps.ViewModels.Auth;

@model SubscriptionDisplayViewModel
@*TODO: Currently mentions of pricing are commented out. When pricing is properly implemented, restore these mentions.
    Also remove the damn hardcoded "free users" numbers.*@
@{
    ViewBag.Title = Strings.Subscriptions;
    ViewBag.ShowAll = true;
    string productTier = Model.Info != null ? Model.Info.Tier : string.Empty;
    string getText = string.IsNullOrWhiteSpace(productTier) ? Strings.Subscribe : productTier == "Free" ? Strings.Manage : Strings.Upgrade;
    string userDisplay = string.Empty;
    string price = string.Empty;
    if (Model.Info != null)
    {
        userDisplay = string.Format("{0}/{1} {2}", Model.Info.SubscriptionsUsed, Model.Info.NumberOfUsers, Strings.Users);
        // price = (Model.Info.NumberOfUsers - 500) <= 0 ? Strings.Free : (Model.Info.NumberOfUsers - 500).ToString("c");
        price = "";
    }
}

<table class="table table-striped table-sparse">
    <tr>
        @if (Model.ProductName == ProductNameKeyConstants.TimeTracker)
        {
            <td>
                @Strings.TimeTracker
            </td>
        }
        @if (Model.Info != null)
        {
            <td>@userDisplay</td>
            <td class="text-right">
                @price
            </td>
            <td class="text-right icon-strip">
                @*@if (Model.CanEditSubscriptions)
                {*@
                    <a href="@Url.Action(ActionConstants.Subscribe, ControllerConstants.Account, new { id = Model.OrganizationId, productId = @Model.ProductId })"
                       class="text-muted" title="@Strings.EditSubscription"><span class="fa fa-fw fa-dollar text-success"></span></a>

                    @using (Html.BeginForm(ActionConstants.Unsubscribe, ControllerConstants.Account, new { id = Model.OrganizationId }, FormMethod.Get, new { @style = "display: inline"}))
                    {
                        @*<input data-val="true" id="ID" name="ID" type="hidden" value="@Model.ProductId" />*@
                        <input type="hidden" name="productId" value="@Model.ProductId" />
                        <a href="javascript:void(0);" class="text-muted" title="@Strings.DropSubcription" onclick="$(this).closest('form').submit()"><span class="fa fa-fw fa-remove text-danger"></span></a>
                    }
                @*}*@
            </td>
        }
        else
        {
            <td class="text-right">
                @Html.ActionLink(getText, ActionConstants.Subscribe, ControllerConstants.Account, new { id = Model.OrganizationId, productId = Model.ProductId }, null)
            </td>
        }
    </tr>
</table>

<script>
    function confirmUnsubscribe(subname) {
        return confirm("@(Strings.WarningWhenUnsubscribing)".replace(/%subname%/g, subname))
    }
</script>
